<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>EcoPisk - Inversi√≥n</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { background: #0a1f0a; color: white; font-family: sans-serif; text-align: center; padding: 50px; }
        .card { background: #1a3a1a; padding: 30px; border-radius: 20px; border: 2px solid #4CAF50; display: inline-block; }
        
        /* TU BOT√ìN RESPLANDECIENTE */
        .boton-glow {
            background-color: #ffffff; color: #000; padding: 20px 50px; border: none;
            border-radius: 50px; font-size: 22px; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 20px #00d4ff, 0 0 40px #00d4ff; transition: 0.3s;
            animation: pulso 2s infinite; margin-top: 20px;
        }
        @keyframes pulso {
            0% { transform: scale(1); box-shadow: 0 0 20px #00d4ff; }
            50% { transform: scale(1.02); box-shadow: 0 0 35px #00ff88; }
            100% { transform: scale(1); box-shadow: 0 0 20px #00d4ff; }
        }
    </style>
</head>
<body>

    <div class="card">
        <h1>üå≥ PRE-SALE ECOPISK</h1>
        <p>Precio: 0.10 USDT = 1 PISK</p>
        <button class="boton-glow" onclick="procesoCompra()">üõí COMPRAR PISK AHORA</button>
        <p id="status" style="margin-top: 20px; color: #00ff88;"></p>
    </div>

    <script>
        // DIRECCIONES CORREGIDAS (Checksum OK)
        const contratoVenta = "0x86A0Bb8440189051fB38298Ef3a93E958597E51f";
        const tokenUSDT = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";

        const abiUSDT = ["function approve(address spender, uint256 amount) public returns (bool)"];
        const abiVenta = ["function comprar(uint256 _cantidadUSDT) public"];

        async function procesoCompra() {
            const status = document.getElementById("status");
            if (!window.ethereum) return alert("Instala MetaMask");

            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                const signer = provider.getSigner();

                // 1. PASO: APROBAR (0.5 USDT = 500000 unidades)
                status.innerText = "Paso 1: Autorizando USDT...";
                const contratoToken = new ethers.Contract(tokenUSDT, abiUSDT, signer);
                const txApprove = await contratoToken.approve(contratoVenta, 500000);
                await txApprove.wait();

                // 2. PASO: COMPRAR
                status.innerText = "Paso 2: Ejecutando compra...";
                const contratoVentaObj = new ethers.Contract(contratoVenta, abiVenta, signer);
                const txCompra = await contratoVentaObj.comprar(500000);
                await txCompra.wait();

                status.innerText = "‚úÖ ¬°COMPRA EXITOSA! Revisa tu MetaMask.";
                alert("¬°Felicidades, ya eres inversor de EcoPisk!");

            } catch (err) {
                console.error(err);
                status.innerText = "‚ùå Error en la transacci√≥n.";
                alert("Hubo un problema: " + err.message);
            }
        }
    </script>
</body>
</html>
