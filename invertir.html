<!DOCTYPE html>
<html>
<head>
    <title>EcoPisk - Venta Directa</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <style>
        body { background: #0a1f0a; color: white; font-family: sans-serif; text-align: center; padding: 50px; }
        .boton-final { background: #00d4ff; color: black; padding: 25px; border-radius: 50px; font-size: 24px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px #00d4ff; border: none; }
    </style>
</head>
<body>
    <h1>üå≥ ECOPISK: RONDA SEMILLA</h1>
    <p>Precio: 0.10 USDT = 1 PISK</p>
    <br>
    <button class="boton-final" onclick="ejecutarCompra()">üõí COMPRAR PISK AHORA</button>
    <p id="log" style="margin-top:20px; color:#00ff88;"></p>

    <script>
        // DIRECCIONES COPIADAS DIRECTAMENTE DEL EXPLORADOR
        const VENTA = "0x86A0Bb8440189051fB38298Ef3a93E958597E51f";
        const USDT = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";

        async function ejecutarCompra() {
            const log = document.getElementById("log");
            if (!window.ethereum) return alert("Instala MetaMask");

            try {
                log.innerText = "Conectando...";
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                const signer = provider.getSigner();

                // USAMOS ESTA FUNCI√ìN PARA FORZAR EL CHECKSUM CORRECTO
                const ventaLimpia = ethers.utils.getAddress(VENTA);
                const usdtLimpio = ethers.utils.getAddress(USDT);

                log.innerText = "Autorizando USDT...";
                const cUSDT = new ethers.Contract(usdtLimpio, ["function approve(address s, uint256 a) public returns (bool)"], signer);
                const tx1 = await cUSDT.approve(ventaLimpia, "500000"); // 0.5 USDT
                await tx1.wait();

                log.innerText = "Confirmando Compra...";
                const cVenta = new ethers.Contract(ventaLimpia, ["function comprar(uint256 a) public"], signer);
                const tx2 = await cVenta.comprar("500000");
                await tx2.wait();

                log.innerText = "‚úÖ ¬°ERES INVERSOR DE ECOPISK!";
                alert("¬°Compra exitosa, Ernesto!");
            } catch (e) {
                log.innerText = "‚ùå Error: Revisa tu saldo o conexi√≥n";
                console.log(e);
            }
        }
    </script>
</body>
</html>
