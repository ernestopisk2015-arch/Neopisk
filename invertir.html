<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        .pisk-box {
            background: #1a3a1a; color: white; border: 2px solid #4CAF50;
            padding: 25px; border-radius: 15px; text-align: center;
            font-family: sans-serif; max-width: 350px; margin: auto;
        }
        .btn-pisk {
            background: linear-gradient(45deg, #4CAF50, #00d4ff);
            color: white; border: none; padding: 15px 25px;
            border-radius: 50px; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }
        #msg { font-size: 12px; margin-top: 15px; color: #00ff88; }
    </style>
</head>
<body>

<div class="pisk-box">
    <h3>EcoPisk Pre-Sale</h3>
    <p>Price: 1 PISK = 0.10 USDT</p>
    <button class="btn-pisk" onclick="invertir()">üõí BUY 5 PISK (0.5 USDT)</button>
    <div id="msg">Connect your MetaMask</div>
</div>

<script>
    async function invertir() {
        const msg = document.getElementById("msg");
        if (!window.ethereum) return alert("Install MetaMask");

        try {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            const signer = provider.getSigner();

            // ESTO CORRIGE EL ERROR DE MAY√öSCULAS AUTOM√ÅTICAMENTE
            const contratoVenta = ethers.utils.getAddress("0x86A0Bb8440189051fB38298Ef3a93E958597E51f");
            const tokenUSDT = ethers.utils.getAddress("0xc2132D05D31c914a87C6611C10748AEb04B58e8F");

            msg.innerText = "Step 1: Approving USDT...";
            const cUSDT = new ethers.Contract(tokenUSDT, ["function approve(address s, uint256 a) public returns (bool)"], signer);
            const tx1 = await cUSDT.approve(contratoVenta, "500000");
            await tx1.wait();

            msg.innerText = "Step 2: Confirming Purchase...";
            const cVenta = new ethers.Contract(contratoVenta, ["function comprar(uint256 a) public"], signer);
            const tx2 = await cVenta.comprar("500000");
            await tx2.wait();

            msg.innerText = "‚úÖ Success! PISK tokens sent.";
            alert("Congratulations! You are now an investor.");
        } catch (e) {
            msg.innerText = "‚ùå Error: Check your balance (USDT/MATIC)";
            console.error(e);
        }
    }
</script>
</body>
</html>

