<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neo Pisk - Venta USDT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { background: #0b0e11; color: white; font-family: sans-serif; text-align: center; padding: 40px 20px; }
        .card { border: 2px solid #f0b90b; border-radius: 15px; padding: 20px; background: #181a20; max-width: 350px; margin: auto; }
        button { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; }
        #btnConectar { background: #f0b90b; color: black; }
        #btnAccion { background: #2ebd85; color: white; display: none; }
        input { width: 80%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #474d57; background: #1e2329; color: white; }
    </style>
</head>
<body>

<div class="card">
    <h1 style="color:#f0b90b">NEO PISK ðŸš€</h1>
    <p id="status">Conecta tu billetera para empezar</p>
    
    <button id="btnConectar">CONECTAR BILLETERA</button>

    <div id="buyArea" style="display:none">
        <p>Â¿CuÃ¡ntos PISK quieres comprar?</p>
        <input type="number" id="cantidad" value="1" min="1">
        <button id="btnAccion">1. APROBAR USDT</button>
    </div>
</div>

<script>
    const ADDR_VENTA = "0x82e8c25Ac7Bb8Dee626098DB1964C4a00C3Cc5fC";
    const ADDR_USDT = "0xc2132D05D31c914A87C6611C10748AEb04B58e8F"; // USDT oficial en Polygon
    let signer;

    const btnConectar = document.getElementById('btnConectar');
    const btnAccion = document.getElementById('btnAccion');
    const status = document.getElementById('status');
    const buyArea = document.getElementById('buyArea');

    btnConectar.onclick = async () => {
        if (!window.ethereum) return alert("Instala MetaMask");
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        
        status.innerText = "Conectado: " + accounts[0].substring(0,6);
        btnConectar.style.display = 'none';
        buyArea.style.display = 'block';
        btnAccion.style.display = 'block';
    };

    btnAccion.onclick = async () => {
        try {
            const cant = document.getElementById('cantidad').value;
            const precio = 10000; // SegÃºn tu contrato
            const totalCosto = cant * precio;

            const usdtContract = new ethers.Contract(ADDR_USDT, ["function approve(address spender, uint256 amount) public returns (bool)"], signer);
            const ventaContract = new ethers.Contract(ADDR_VENTA, ["function comprar(uint256 cantidad) external"], signer);

            if (btnAccion.innerText.includes("APROBAR")) {
                status.innerText = "Aprobando USDT... Revisa el zorrito";
                const txApprove = await usdtContract.approve(ADDR_VENTA, "1000000000000000000"); // AprobaciÃ³n alta para no repetir
                await txApprove.wait();
                btnAccion.innerText = "2. CONFIRMAR COMPRA";
                status.innerText = "Â¡USDT Aprobado! Ahora dale a COMPRAR";
            } else {
                status.innerText = "Comprando PISK... Revisa el zorrito";
                const txBuy = await ventaContract.comprar(cant);
                await txBuy.wait();
                status.innerText = "Â¡COMPRA EXITOSA! ðŸŽ‰";
                btnAccion.innerText = "COMPRA OTRA VEZ";
            }
        } catch (e) {
            console.error(e);
            status.innerText = "Error. Abre el zorrito manualmente.";
        }
    };
</script>
</body>
  </html>
  
