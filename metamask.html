<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neo Pisk ‚Äî Comprar $PISK</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --gold:#D4A017;--gold2:#F0C040;--gold3:#FFF3B0;
  --dark:#07090C;--dark2:#0D1117;--dark3:#111820;
  --border:rgba(212,160,23,0.2);--border2:rgba(212,160,23,0.06);
  --text:#E8EDF5;--muted:#7A8A9A;--muted2:#3A4A5A;
  --green:#00E676;--red:#FF3D3D;--orange:#F6851B;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--dark);color:var(--text);font-family:'Barlow Condensed',sans-serif;min-height:100vh;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(212,160,23,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(212,160,23,0.03) 1px,transparent 1px);background-size:48px 48px;pointer-events:none;z-index:0;}
.wrap{position:relative;z-index:1;max-width:440px;margin:0 auto;padding:20px 16px 60px;}

.header{text-align:center;padding:24px 20px 18px;border-bottom:1px solid var(--border);margin-bottom:20px;}
.logo-row{display:flex;justify-content:center;gap:14px;margin-bottom:12px;}
.logo-img{width:56px;height:56px;border-radius:50%;border:2px solid var(--gold);box-shadow:0 0 16px rgba(212,160,23,0.3);object-fit:cover;}
.header-title{font-family:'Bebas Neue';font-size:34px;letter-spacing:4px;background:linear-gradient(180deg,var(--gold3),var(--gold2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1;margin-bottom:4px;}
.header-sub{font-size:10px;letter-spacing:5px;color:var(--muted);font-family:'JetBrains Mono';}

/* PRECIO */
.price-card{background:var(--dark2);border:1px solid var(--border);padding:18px;margin-bottom:16px;position:relative;overflow:hidden;text-align:center;}
.price-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),transparent);}
.price-tag{font-family:'Bebas Neue';font-size:48px;color:var(--gold2);line-height:1;}
.price-sub{font-size:11px;letter-spacing:3px;color:var(--muted);font-family:'JetBrains Mono';}
.price-row{display:flex;justify-content:center;gap:24px;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);}
.price-item .val{font-family:'Bebas Neue';font-size:22px;color:var(--green);}
.price-item .lbl{font-size:9px;letter-spacing:2px;color:var(--muted);font-family:'JetBrains Mono';}

/* CALCULADORA */
.calc-card{background:var(--dark2);border:1px solid var(--border);padding:18px;margin-bottom:16px;position:relative;overflow:hidden;}
.calc-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),transparent);}
.input-lbl{font-size:10px;letter-spacing:3px;color:var(--muted);font-family:'JetBrains Mono';margin-bottom:6px;}
.input-field{width:100%;background:var(--dark3);border:1px solid var(--border);color:var(--text);padding:14px;font-family:'JetBrains Mono';font-size:28px;text-align:center;outline:none;transition:border-color 0.2s;margin-bottom:8px;}
.input-field:focus{border-color:var(--gold);}
.input-field::placeholder{color:var(--muted2);}
.calc-result{background:var(--dark3);border:1px solid var(--border);padding:12px;text-align:center;}
.calc-lbl{font-size:10px;letter-spacing:3px;color:var(--muted);font-family:'JetBrains Mono';margin-bottom:4px;}
.calc-val{font-family:'Bebas Neue';font-size:38px;color:var(--gold2);}

/* PASOS */
.section-tag{font-family:'Bebas Neue';font-size:11px;letter-spacing:4px;color:var(--gold);margin:20px 0 12px;display:flex;align-items:center;gap:8px;}
.section-tag::after{content:'';flex:1;height:1px;background:var(--border);}

.step-card{background:var(--dark2);border:1px solid var(--border);padding:16px;margin-bottom:8px;display:flex;gap:14px;align-items:flex-start;position:relative;overflow:hidden;}
.step-card.active-step::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--gold);}
.step-n{width:28px;height:28px;border-radius:50%;border:2px solid var(--gold);display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue';font-size:15px;color:var(--gold);flex-shrink:0;margin-top:2px;}
.step-title{font-family:'Bebas Neue';font-size:16px;letter-spacing:1px;color:var(--text);margin-bottom:4px;}
.step-desc{font-size:13px;color:var(--muted);line-height:1.5;}
.step-desc strong{color:var(--text);}

/* URL BOX */
.url-box{background:var(--dark3);border:1px solid var(--gold);padding:14px;margin:10px 0;text-align:center;}
.url-text{font-family:'JetBrains Mono';font-size:16px;color:var(--gold2);letter-spacing:1px;margin-bottom:10px;}
.btn-copy{width:100%;padding:14px;background:linear-gradient(135deg,var(--gold),#8B6914);color:var(--dark);border:none;font-family:'Bebas Neue';font-size:18px;letter-spacing:3px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.btn-copy:active{transform:scale(0.98);}
.btn-copy.copied{background:linear-gradient(135deg,var(--green),#006633);}

/* WALLET REGISTER */
.wallet-card{background:var(--dark2);border:1px solid var(--border);padding:18px;margin-bottom:16px;}
.wallet-input{width:100%;background:var(--dark3);border:1px solid var(--border);color:var(--text);padding:12px;font-family:'JetBrains Mono';font-size:12px;outline:none;margin-bottom:10px;transition:border-color 0.2s;}
.wallet-input:focus{border-color:var(--gold);}
.wallet-input::placeholder{color:var(--muted2);font-size:11px;}
.btn-wallet{width:100%;padding:14px;background:var(--dark3);border:1px solid var(--border);color:var(--text);font-family:'Bebas Neue';font-size:16px;letter-spacing:2px;cursor:pointer;transition:all 0.2s;}
.btn-wallet:active{transform:scale(0.98);}
.btn-wallet.saved{border-color:var(--green);color:var(--green);}

/* INFO */
.info-box{background:rgba(212,160,23,0.06);border:1px solid var(--border);padding:14px;margin-bottom:16px;}
.info-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border2);}
.info-row:last-child{border:none;}
.info-key{font-size:10px;letter-spacing:2px;color:var(--muted);font-family:'JetBrains Mono';}
.info-val{font-family:'Bebas Neue';font-size:14px;color:var(--gold2);}
.sold-badge{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.2);padding:2px 8px;font-family:'JetBrains Mono';font-size:10px;color:var(--green);}
.phase-badge{background:rgba(212,160,23,0.1);border:1px solid var(--border);padding:2px 8px;font-family:'JetBrains Mono';font-size:10px;color:var(--gold);}

.legal-box{background:var(--dark3);border:1px solid var(--border2);padding:12px;font-size:10px;color:var(--muted2);line-height:1.7;font-family:'JetBrains Mono';margin-top:14px;}
.divider{height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:14px 0;}

@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.wrap>*{animation:fadeUp 0.4s ease both;}
</style>
</head>
<body>
<div class="wrap">

  <div class="header">
    <div class="logo-row">
      <img src="asset/IMG-20260126-WA0020.jpg" class="logo-img" alt="Neo Pisk">
      <img src="asset/Eco Pisk.jpg" class="logo-img" alt="Eco Pisk">
    </div>
    <div class="header-title">NEO PISK</div>
    <div class="header-sub">COMPRAR $PISK ¬∑ POLYGON</div>
  </div>

  <!-- PRECIO -->
  <div class="price-card">
    <div class="price-sub">PRECIO DE PREVENTA FASE 2</div>
    <div class="price-tag">$0.10 USD</div>
    <div class="price-row">
      <div class="price-item"><div class="val">10 $PISK</div><div class="lbl">POR 1 USDT</div></div>
      <div class="price-item"><div class="val">POLYGON</div><div class="lbl">RED</div></div>
      <div class="price-item"><div class="val" id="stockVal">...</div><div class="lbl">EN STOCK</div></div>
    </div>
  </div>

  <!-- CALCULADORA -->
  <div class="section-tag">CALCULADORA</div>
  <div class="calc-card">
    <div class="input-lbl">¬øCU√ÅNTO USDT QUIERES INVERTIR?</div>
    <input class="input-field" type="number" id="inputUSDT" placeholder="10" min="1" step="any" value="10" oninput="calcular()">
    <div class="calc-result">
      <div class="calc-lbl">RECIBIR√ÅS</div>
      <div class="calc-val" id="resultPisk">100 $PISK</div>
    </div>
  </div>

  <!-- PASOS -->
  <div class="section-tag">C√ìMO COMPRAR</div>

  <div class="step-card active-step">
    <div class="step-n">1</div>
    <div>
      <div class="step-title">ABRE METAMASK APP</div>
      <div class="step-desc">En tu celular abre la app de <strong>MetaMask</strong> ‚Üí toca el √≠cono del <strong>navegador</strong> (üåê globo abajo)</div>
    </div>
  </div>

  <div class="step-card active-step">
    <div class="step-n">2</div>
    <div>
      <div class="step-title">COPIA Y PEGA ESTA URL</div>
      <div class="step-desc">Toca el bot√≥n para copiar y p√©gala en el navegador de MetaMask</div>
      <div class="url-box">
        <div class="url-text" id="urlDisplay">neopisk.lat/metamask.html</div>
        <button class="btn-copy" id="btnCopyUrl" onclick="copiarUrl()">üìã COPIAR URL</button>
      </div>
    </div>
  </div>

  <div class="step-card active-step">
    <div class="step-n">3</div>
    <div>
      <div class="step-title">CONECTA TU WALLET</div>
      <div class="step-desc">En la p√°gina que se abre: toca <strong>Conectar Wallet</strong> ‚Üí aprueba en MetaMask</div>
    </div>
  </div>

  <div class="step-card active-step">
    <div class="step-n">4</div>
    <div>
      <div class="step-title">INGRESA EL MONTO Y COMPRA</div>
      <div class="step-desc">Escribe <strong id="montoSugerido">10 USDT</strong> ‚Üí toca <strong>‚ë† Autorizar USDT</strong> ‚Üí luego <strong>‚ë° Comprar $PISK</strong></div>
    </div>
  </div>

  <div class="step-card">
    <div class="step-n">5</div>
    <div>
      <div class="step-title">REGISTRA TU WALLET AQU√ç</div>
      <div class="step-desc">Para recibir tus comisiones, registra tu wallet de Polygon (la misma que usas en MetaMask)</div>
    </div>
  </div>

  <div class="divider"></div>

  <!-- REGISTRAR WALLET -->
  <div class="section-tag">REGISTRAR WALLET POLYGON</div>
  <div class="wallet-card">
    <div class="input-lbl">TU DIRECCI√ìN WALLET (POLYGON)</div>
    <input class="wallet-input" type="text" id="inputWallet" placeholder="0x... direcci√≥n de tu wallet en MetaMask" id="walletInput">
    <button class="btn-wallet" id="btnWallet" onclick="guardarWallet()">üíæ GUARDAR MI WALLET</button>
    <div id="walletMsg" style="font-size:11px;color:var(--muted);font-family:'JetBrains Mono';margin-top:8px;text-align:center;"></div>
  </div>

  <div class="divider"></div>

  <!-- INFO -->
  <div class="section-tag">TOKENOMICS</div>
  <div class="info-box">
    <div class="info-row"><span class="info-key">EMISI√ìN TOTAL</span><span class="info-val">100,000,000</span></div>
    <div class="info-row"><span class="info-key">POL√çTICA</span><span class="info-val" style="font-size:12px">BUYBACK & BURN</span></div>
    <div class="info-row"><span class="info-key">FASE 1</span><span class="sold-badge">SOLD OUT ‚úì</span></div>
    <div class="info-row" style="border:none"><span class="info-key">FASE 2 ¬∑ PRECIO</span><span class="phase-badge">$0.10 USD</span></div>
  </div>

  <div class="legal-box">‚öñÔ∏è La adquisici√≥n de $PISK representa utilidad digital del ecosistema Neo Pisk. No representa inversi√≥n financiera ni promete retornos garantizados. Red Polygon ¬∑ Contrato verificado.</div>
  <div style="text-align:center;padding:14px 0;font-size:10px;color:var(--muted2);font-family:'JetBrains Mono';">
    ¬© NEO PISK TECH SAC ¬∑ <a href="https://neopisk.lat" style="color:var(--gold);text-decoration:none">neopisk.lat</a>
  </div>
</div>

<script>
const API = 'http://69.169.109.120/airdrop-api';
const tg  = window.Telegram?.WebApp;
if (tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#07090C'); tg.setBackgroundColor('#07090C'); }

// Leer usuario de Telegram
const tgUser = tg?.initDataUnsafe?.user;
const UID    = tgUser?.id || '';
const REF    = new URLSearchParams(window.location.search).get('ref') || '';

// URL con par√°metros del usuario
const COMPRA_URL = `neopisk.lat/metamask.html?uid=${UID}&ref=${REF}`;

window.addEventListener('load', () => {
  calcular();
  document.getElementById('urlDisplay').textContent = COMPRA_URL;
  cargarStock();
  cargarWalletGuardada();
});

function calcular() {
  const usdt = parseFloat(document.getElementById('inputUSDT').value) || 0;
  document.getElementById('resultPisk').textContent = (usdt * 10).toLocaleString() + ' $PISK';
  document.getElementById('montoSugerido').textContent = usdt + ' USDT';
}

function copiarUrl() {
  const url = 'https://' + COMPRA_URL;
  const btn = document.getElementById('btnCopyUrl');
  if (navigator.clipboard) {
    navigator.clipboard.writeText(url).then(() => {
      btn.textContent = '‚úÖ COPIADO ‚Äî PEGA EN METAMASK';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'üìã COPIAR URL'; btn.classList.remove('copied'); }, 3000);
    });
  } else {
    const el = document.createElement('input');
    el.value = url; document.body.appendChild(el); el.select();
    document.execCommand('copy'); document.body.removeChild(el);
    btn.textContent = '‚úÖ COPIADO';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'üìã COPIAR URL'; btn.classList.remove('copied'); }, 3000);
  }
  if (tg) tg.HapticFeedback?.notificationOccurred('success');
}

async function cargarStock() {
  try {
    const r = await fetch(`${API}/stock`);
    const d = await r.json();
    document.getElementById('stockVal').textContent = (d.stock || 0).toLocaleString();
  } catch(e) {
    document.getElementById('stockVal').textContent = '1,018';
  }
}

function cargarWalletGuardada() {
  try {
    const w = localStorage.getItem('pisk_wallet_' + UID);
    if (w) {
      document.getElementById('inputWallet').value = w;
      document.getElementById('walletMsg').textContent = '‚úÖ Wallet guardada';
      document.getElementById('walletMsg').style.color = 'var(--green)';
      document.getElementById('btnWallet').textContent = '‚úÖ WALLET GUARDADA';
      document.getElementById('btnWallet').classList.add('saved');
    }
  } catch(e) {}
}

async function guardarWallet() {
  const wallet = document.getElementById('inputWallet').value.trim();
  if (!wallet || wallet.length < 20) {
    document.getElementById('walletMsg').textContent = '‚ö†Ô∏è Ingresa una wallet v√°lida';
    document.getElementById('walletMsg').style.color = 'var(--red)';
    return;
  }
  try {
    localStorage.setItem('pisk_wallet_' + UID, wallet);
    // Enviar al bot
    await fetch(`${API}/mision`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId: UID, mision: 'wallet', wallet })
    });
    document.getElementById('walletMsg').textContent = '‚úÖ Wallet registrada ‚Äî recibir√°s tus comisiones aqu√≠';
    document.getElementById('walletMsg').style.color = 'var(--green)';
    document.getElementById('btnWallet').textContent = '‚úÖ WALLET GUARDADA';
    document.getElementById('btnWallet').classList.add('saved');
    if (tg) tg.HapticFeedback?.notificationOccurred('success');
  } catch(e) {
    document.getElementById('walletMsg').textContent = '‚úÖ Wallet guardada localmente';
    document.getElementById('walletMsg').style.color = 'var(--green)';
  }
}
</script>
</body>
</html>
