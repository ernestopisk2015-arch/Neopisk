<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neo Pisk â€” Founder Portal</title>
<link rel="icon" type="image/jpg" href="asset/IMG-20260126-WA0020.jpg">
<script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.4/web3.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --gold:#D4A017;--gold2:#F0C040;--gold3:#FFF3B0;
  --dark:#07090C;--dark2:#0D1117;--dark3:#111820;--dark4:#1A2030;
  --border:rgba(212,160,23,0.2);--border2:rgba(212,160,23,0.06);
  --text:#E8EDF5;--muted:#7A8A9A;--muted2:#3A4A5A;
  --green:#00E676;--red:#FF3D3D;--orange:#F6851B;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{
  background:var(--dark);color:var(--text);
  font-family:'Barlow Condensed',sans-serif;
  min-height:100vh;overflow-x:hidden;
}

/* NOISE */
body::before{
  content:'';position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events:none;z-index:0;opacity:0.35;
}

/* GRID BG */
body::after{
  content:'';position:fixed;inset:0;
  background-image:linear-gradient(rgba(212,160,23,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(212,160,23,0.03) 1px,transparent 1px);
  background-size:48px 48px;pointer-events:none;z-index:0;
}

.wrap{position:relative;z-index:1;max-width:480px;margin:0 auto;padding:20px 16px 80px;}

/* â”€â”€ HEADER â”€â”€ */
.header{text-align:center;padding:40px 20px 32px;border-bottom:1px solid var(--border);}
.logo-row{display:flex;justify-content:center;gap:16px;margin-bottom:20px;}
.logo-img{
  width:72px;height:72px;border-radius:50%;
  border:2px solid var(--gold);
  box-shadow:0 0 20px rgba(212,160,23,0.3);
  object-fit:cover;
}
.header-title{font-family:'Bebas Neue';font-size:42px;letter-spacing:4px;
  background:linear-gradient(180deg,var(--gold3),var(--gold2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  line-height:1;margin-bottom:6px;
}
.header-sub{font-size:11px;letter-spacing:5px;color:var(--muted);text-transform:uppercase;font-family:'JetBrains Mono';}

/* â”€â”€ BALANCE CARD â”€â”€ */
.balance-card{
  background:var(--dark2);border:1px solid var(--border);
  padding:24px;margin:20px 0;position:relative;overflow:hidden;
}
.balance-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),transparent);}
.balance-lbl{font-size:10px;letter-spacing:4px;color:var(--muted);font-family:'JetBrains Mono';margin-bottom:8px;}
.balance-val{font-family:'Bebas Neue';font-size:48px;color:var(--gold2);line-height:1;}
.balance-addr{font-family:'JetBrains Mono';font-size:11px;color:var(--muted);margin-top:8px;word-break:break-all;}

/* â”€â”€ STATUS BAR â”€â”€ */
.status-bar{
  padding:10px 14px;border:1px solid var(--border2);
  background:var(--dark3);margin-bottom:16px;
  font-family:'JetBrains Mono';font-size:12px;color:var(--muted);
  display:flex;align-items:center;gap:8px;
}
.status-dot{width:7px;height:7px;border-radius:50%;background:var(--muted2);flex-shrink:0;transition:background 0.3s;}
.status-dot.green{background:var(--green);box-shadow:0 0 8px var(--green);}
.status-dot.red{background:var(--red);}
.status-dot.orange{background:var(--orange);animation:pulse 1s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{
  width:100%;padding:16px;border:none;cursor:pointer;
  font-family:'Bebas Neue';font-size:20px;letter-spacing:3px;
  transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:10px;
  margin-bottom:10px;position:relative;overflow:hidden;
}
.btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,0);transition:background 0.2s;}
.btn:hover::after{background:rgba(255,255,255,0.06);}
.btn:active{transform:scale(0.98);}
.btn:disabled{opacity:0.35;cursor:not-allowed;}

.btn-connect{background:var(--dark3);border:1px solid var(--border);color:var(--gold2);}
.btn-approve{background:var(--dark2);border:1px solid var(--border);color:var(--text);}
.btn-buy{background:linear-gradient(135deg,var(--gold),#8B6914);color:var(--dark);box-shadow:0 0 24px rgba(212,160,23,0.25);}
.btn-buy:hover{box-shadow:0 0 40px rgba(212,160,23,0.4);}
.btn-copy{background:none;border:1px solid var(--border2);color:var(--muted);font-size:14px;letter-spacing:2px;padding:12px;}
.btn-tg{background:rgba(34,158,217,0.1);border:1px solid rgba(34,158,217,0.3);color:#229ED9;font-size:16px;letter-spacing:2px;padding:14px;text-decoration:none;display:flex;align-items:center;justify-content:center;gap:8px;}

/* â”€â”€ INPUT â”€â”€ */
.input-group{margin-bottom:12px;}
.input-lbl{font-size:10px;letter-spacing:3px;color:var(--muted);font-family:'JetBrains Mono';margin-bottom:6px;}
.input-field{
  width:100%;background:var(--dark3);border:1px solid var(--border);
  color:var(--text);padding:16px;font-family:'JetBrains Mono';font-size:18px;
  text-align:center;outline:none;transition:border-color 0.2s;
}
.input-field:focus{border-color:var(--gold);}
.input-field::placeholder{color:var(--muted2);}

/* â”€â”€ SECTION â”€â”€ */
.section{margin:24px 0;}
.section-tag{font-family:'Bebas Neue';font-size:11px;letter-spacing:4px;color:var(--gold);margin-bottom:12px;display:flex;align-items:center;gap:8px;}
.section-tag::after{content:'';flex:1;height:1px;background:var(--border);}

/* â”€â”€ INFO CARDS â”€â”€ */
.info-card{background:var(--dark2);border:1px solid var(--border);padding:20px;margin-bottom:10px;}
.info-card h4{font-family:'Bebas Neue';font-size:16px;letter-spacing:3px;color:var(--gold2);margin-bottom:12px;}
.info-card p{font-size:14px;color:var(--muted);line-height:1.7;}
.info-card strong{color:var(--text);}

/* â”€â”€ STEPS â”€â”€ */
.steps{list-style:none;}
.steps li{
  display:flex;gap:12px;padding:10px 0;border-bottom:1px solid var(--border2);
  font-size:15px;color:var(--muted);
}
.steps li:last-child{border:none;}
.step-n{
  width:22px;height:22px;border-radius:50%;border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  font-family:'Bebas Neue';font-size:13px;color:var(--gold);flex-shrink:0;
}

/* â”€â”€ PRESALE â”€â”€ */
.presale-box{background:var(--dark2);border:1px solid var(--border);padding:20px;}
.presale-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border2);}
.presale-row:last-child{border:none;}
.presale-key{font-size:12px;letter-spacing:2px;color:var(--muted);font-family:'JetBrains Mono';}
.presale-val{font-family:'Bebas Neue';font-size:18px;color:var(--gold2);}
.phase-badge{background:rgba(212,160,23,0.1);border:1px solid var(--border);padding:3px 10px;font-family:'JetBrains Mono';font-size:10px;color:var(--gold);letter-spacing:2px;}
.sold-badge{background:rgba(0,230,118,0.1);border:1px solid rgba(0,230,118,0.2);padding:3px 10px;font-family:'JetBrains Mono';font-size:10px;color:var(--green);letter-spacing:2px;}
.progress-wrap{margin:12px 0;}
.progress-lbl{font-size:11px;color:var(--muted);font-family:'JetBrains Mono';margin-bottom:6px;display:flex;justify-content:space-between;}
.progress-bg{height:4px;background:var(--dark4);position:relative;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold2));transition:width 1s ease;}

/* â”€â”€ LEGAL â”€â”€ */
.legal-box{background:var(--dark3);border:1px solid var(--border2);padding:16px;font-size:12px;color:var(--muted2);line-height:1.7;font-family:'JetBrains Mono';}

/* â”€â”€ CONTRACT â”€â”€ */
.contract-box{background:var(--dark3);border:1px solid var(--border2);padding:12px 14px;font-family:'JetBrains Mono';font-size:10px;color:var(--muted);word-break:break-all;margin-bottom:6px;}

/* â”€â”€ FLOAT BTN â”€â”€ */
.float-btn{
  position:fixed;bottom:20px;right:16px;
  background:rgba(34,158,217,0.15);border:1px solid rgba(34,158,217,0.3);
  width:56px;height:56px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  text-decoration:none;z-index:100;backdrop-filter:blur(12px);
  transition:all 0.2s;
}
.float-btn:hover{background:rgba(34,158,217,0.25);transform:scale(1.1);}

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(7,9,12,0.97);z-index:1000;
  align-items:center;justify-content:center;padding:20px;
}
.modal-box{
  background:var(--dark2);border:1px solid var(--border);
  padding:32px 24px;max-width:360px;width:100%;text-align:center;
  position:relative;
}
.modal-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--orange),transparent);}
.modal-icon{margin:0 auto 20px;}
.modal-title{font-family:'Bebas Neue';font-size:26px;letter-spacing:3px;color:var(--orange);margin-bottom:10px;}
.modal-desc{font-size:15px;color:var(--muted);line-height:1.7;margin-bottom:24px;}
.modal-desc strong{color:var(--text);}
.btn-modal-open{width:100%;padding:16px;background:var(--orange);color:#fff;border:none;font-family:'Bebas Neue';font-size:20px;letter-spacing:3px;cursor:pointer;margin-bottom:10px;transition:all 0.2s;}
.btn-modal-open:hover{background:#e2761b;}
.btn-modal-cancel{width:100%;padding:12px;background:none;border:1px solid var(--border);color:var(--muted);font-family:'Bebas Neue';font-size:14px;letter-spacing:2px;cursor:pointer;}

/* â”€â”€ DIVIDER â”€â”€ */
.divider{height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:20px 0;}

/* â”€â”€ ANIMATIONS â”€â”€ */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.wrap > *{animation:fadeUp 0.5s ease both;}
.wrap > *:nth-child(1){animation-delay:0.05s}
.wrap > *:nth-child(2){animation-delay:0.1s}
.wrap > *:nth-child(3){animation-delay:0.15s}
.wrap > *:nth-child(4){animation-delay:0.2s}
.wrap > *:nth-child(5){animation-delay:0.25s}
</style>
</head>
<body>

<!-- MODAL METAMASK -->
<div id="metamaskModal" class="modal-overlay">
  <div class="modal-box">
    <svg class="modal-icon" width="80" height="80" viewBox="0 0 318.6 318.6" xmlns="http://www.w3.org/2000/svg">
      <polygon fill="#E2761B" stroke="#E2761B" points="274.1,35.5 174.6,109.4 193,65.8"/>
      <g fill="#E4761B" stroke="#E4761B">
        <polygon points="44.4,35.5 143.1,110.1 125.6,65.8"/>
        <polygon points="238.3,206.8 211.8,247.4 268.5,263 284.8,207.7"/>
        <polygon points="33.9,207.7 50.1,263 106.8,247.4 80.3,206.8"/>
        <polygon points="103.6,138.2 87.8,162.1 144.1,164.6 142.1,104.1"/>
        <polygon points="214.9,138.2 175.9,103.4 174.6,164.6 230.8,162.1"/>
        <polygon points="106.8,247.4 140.6,230.9 111.4,208.1"/>
        <polygon points="177.9,230.9 211.8,247.4 207.1,208.1"/>
      </g>
      <g fill="#D7C1B3" stroke="#D7C1B3">
        <polygon points="211.8,247.4 177.9,230.9 180.6,253 180.3,262.3"/>
        <polygon points="106.8,247.4 138.3,262.3 138.1,253 140.6,230.9"/>
      </g>
      <polygon fill="#233447" stroke="#233447" points="138.8,193.5 110.6,185.2 130.5,176.1"/>
      <polygon fill="#233447" stroke="#233447" points="179.7,193.5 188,176.1 208,185.2"/>
      <g fill="#CD6116" stroke="#CD6116">
        <polygon points="106.8,247.4 111.6,206.8 80.3,207.7"/>
        <polygon points="207,206.8 211.8,247.4 238.3,207.7"/>
        <polygon points="230.8,162.1 174.6,164.6 179.8,193.5 188.1,176.1 208.1,185.2"/>
        <polygon points="110.6,185.2 130.6,176.1 138.8,193.5 144.1,164.6 87.8,162.1"/>
      </g>
      <g fill="#E4751F" stroke="#E4751F">
        <polygon points="87.8,162.1 111.4,208.1 110.6,185.2"/>
        <polygon points="208.1,185.2 207.1,208.1 230.8,162.1"/>
        <polygon points="144.1,164.6 138.8,193.5 145.4,227.6 146.9,182.7"/>
        <polygon points="174.6,164.6 171.9,182.6 173.1,227.6 179.8,193.5"/>
      </g>
      <polygon fill="#F6851B" stroke="#F6851B" points="179.8,193.5 173.1,227.6 177.9,230.9 207.1,208.1 208.1,185.2"/>
      <polygon fill="#F6851B" stroke="#F6851B" points="110.6,185.2 111.4,208.1 140.6,230.9 145.4,227.6 138.8,193.5"/>
      <polygon fill="#C0AD9E" stroke="#C0AD9E" points="180.3,262.3 180.6,253 178.1,250.8 140.4,250.8 138.1,253 138.3,262.3 106.8,247.4 117.8,256.4 140.1,271.9 178.4,271.9 200.8,256.4 211.8,247.4"/>
      <polygon fill="#161616" stroke="#161616" points="177.9,230.9 173.1,227.6 145.4,227.6 140.6,230.9 138.1,253 140.4,250.8 178.1,250.8 180.6,253"/>
      <g fill="#763D16" stroke="#763D16">
        <polygon points="278.3,114.2 286.8,73.4 274.1,35.5 177.9,106.9 214.9,138.2 267.2,153.5 278.8,140 273.8,136.4 281.8,129.1 275.6,124.3 283.6,118.2"/>
        <polygon points="31.8,73.4 40.3,114.2 34.9,118.2 42.9,124.3 36.8,129.1 44.8,136.4 39.8,140 51.3,153.5 103.6,138.2 140.6,106.9 44.4,35.5"/>
      </g>
      <polygon fill="#F6851B" stroke="#F6851B" points="267.2,153.5 214.9,138.2 230.8,162.1 207.1,208.1 238.3,207.7 284.8,207.7"/>
      <polygon fill="#F6851B" stroke="#F6851B" points="103.6,138.2 51.3,153.5 33.9,207.7 80.3,207.7 111.4,208.1 87.8,162.1"/>
      <polygon fill="#F6851B" stroke="#F6851B" points="174.6,164.6 177.9,106.9 193.1,65.8 125.6,65.8 140.6,106.9 144.1,164.6 145.3,182.8 145.4,227.6 173.1,227.6 173.3,182.8"/>
    </svg>
    <div class="modal-title">ABRIR EN METAMASK</div>
    <p class="modal-desc">Para conectar tu billetera, abre esta pÃ¡gina dentro del <strong>navegador de MetaMask</strong></p>
    <button class="btn-modal-open" onclick="abrirEnMetaMask()">ğŸ¦Š ABRIR EN METAMASK</button>
    <button class="btn-modal-cancel" onclick="cerrarModalMetaMask()">CANCELAR</button>
  </div>
</div>

<div class="wrap">

  <!-- HEADER -->
  <div class="header">
    <div class="logo-row">
      <img src="asset/IMG-20260126-WA0020.jpg" class="logo-img" alt="Neo Pisk">
      <img src="asset/Eco Pisk.jpg" class="logo-img" alt="Eco Pisk">
    </div>
    <div class="header-title">NEO PISK</div>
    <div class="header-sub">PORTAL SOCIO FUNDADOR</div>
  </div>

  <!-- BALANCE -->
  <div class="balance-card">
    <div class="balance-lbl">TU BALANCE</div>
    <div class="balance-val" id="saldoDisplay">0.00 $PISK</div>
    <div class="balance-addr" id="walletAddr">â€”</div>
  </div>

  <!-- STATUS -->
  <div class="status-bar">
    <div class="status-dot" id="statusDot"></div>
    <span id="status">Polygon Network Â· Listo</span>
  </div>

  <!-- CONNECT -->
  <button class="btn btn-connect" onclick="conectarWallet()">
    ğŸ”Œ CONECTAR BILLETERA
  </button>

  <div class="divider"></div>

  <!-- COMPRA -->
  <div class="section">
    <div class="section-tag">COMPRAR $PISK</div>
    <div class="input-group">
      <div class="input-lbl">MONTO EN USDT</div>
      <input class="input-field" type="number" id="inputUSDT" placeholder="0.00" min="1" step="any" oninput="calcularPisk()">
      <div style="font-size:12px;color:var(--muted);font-family:'JetBrains Mono';margin-top:6px;text-align:center;" id="piskCalc">â€” $PISK</div>
    </div>
    <button class="btn btn-approve" onclick="approveUSDT()">
      <span>â‘ </span> AUTORIZAR USDT
    </button>
    <button class="btn btn-buy" onclick="buyPisk()">
      <span>â‘¡</span> ADQUIRIR $PISK
    </button>
  </div>

  <div class="divider"></div>

  <!-- INSTRUCCIONES -->
  <div class="section">
    <div class="section-tag">CÃ“MO CONECTAR</div>
    <div class="info-card">
      <ul class="steps">
        <li><div class="step-n">1</div><span>Copia la URL con el botÃ³n de abajo</span></li>
        <li><div class="step-n">2</div><span>Abre la app <strong>MetaMask</strong> en tu celular</span></li>
        <li><div class="step-n">3</div><span>Toca el Ã­cono del navegador ğŸ”</span></li>
        <li><div class="step-n">4</div><span>Pega la URL y conecta tu billetera</span></li>
        <li><div class="step-n">5</div><span>Autoriza USDT â†’ luego compra $PISK</span></li>
      </ul>
    </div>
    <button class="btn btn-copy" onclick="copiarURL()">ğŸ“‹ COPIAR URL PARA METAMASK</button>
    <button class="btn btn-copy" onclick="copyContract()" style="margin-bottom:10px;">COPIAR CONTRATO $PISK</button>
    <a href="https://t.me/NeoPisk_bot" class="btn btn-tg" target="_blank">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/></svg>
      ASISTENCIA 24/7 TELEGRAM
    </a>
  </div>

  <div class="divider"></div>

  <!-- PREVENTA -->
  <div class="section">
    <div class="section-tag">TOKENOMICS</div>
    <div class="presale-box">
      <div class="presale-row">
        <span class="presale-key">EMISIÃ“N TOTAL</span>
        <span class="presale-val">100,000,000</span>
      </div>
      <div class="presale-row">
        <span class="presale-key">POLÃTICA</span>
        <span class="presale-val" style="font-size:14px">BUYBACK & BURN</span>
      </div>
      <div class="presale-row">
        <span class="presale-key">FASE 1</span>
        <span class="sold-badge">SOLD OUT âœ“</span>
      </div>
      <div class="presale-row" style="border:none;padding-bottom:0">
        <span class="presale-key">FASE 2 Â· ACTUAL</span>
        <span class="phase-badge">$0.10 USD</span>
      </div>
      <div class="progress-wrap">
        <div class="progress-lbl"><span>PROGRESO FASE 2</span><span style="color:var(--gold)">15%</span></div>
        <div class="progress-bg"><div class="progress-fill" style="width:15%"></div></div>
      </div>
    </div>
  </div>

  <div class="divider"></div>

  <!-- CONTRACT -->
  <div class="section">
    <div class="section-tag">CONTRATOS VERIFICADOS</div>
    <div style="font-size:11px;color:var(--muted);font-family:'JetBrains Mono';margin-bottom:4px;letter-spacing:1px;">CONTRATO $PISK</div>
    <div class="contract-box">0x9d5B2A73d16dAF61712BA8527d94F6997a0E6323</div>
    <div style="font-size:11px;color:var(--muted);font-family:'JetBrains Mono';margin-bottom:4px;margin-top:10px;letter-spacing:1px;">CONTRATO PREVENTA</div>
    <div class="contract-box">0x07Fc7AC9D681Cdd3D100c68f6f5646970CC7fF60</div>
    <div style="font-size:10px;color:var(--muted2);font-family:'JetBrains Mono';margin-top:8px;">RED: POLYGON MAINNET Â· CHAIN ID: 137</div>
  </div>

  <!-- LEGAL -->
  <div class="legal-box">
    âš–ï¸ AVISO LEGAL: La adquisiciÃ³n de $PISK representa utilidad digital diseÃ±ada para el ecosistema Neo Pisk. El usuario acepta la gobernanza digital para el desarrollo de infraestructura en Lima Este. Este token no representa una inversiÃ³n financiera ni promete retornos garantizados.
  </div>

  <div style="text-align:center;padding:24px 0;font-size:11px;color:var(--muted2);font-family:'JetBrains Mono';">
    Â© NEO PISK TECH SAC Â· <a href="https://neopisk.lat" style="color:var(--gold);text-decoration:none">neopisk.lat</a>
  </div>

</div>

<!-- FLOAT TELEGRAM -->
<a href="https://t.me/NeoPisk_bot" class="float-btn" target="_blank">
  <svg width="26" height="26" viewBox="0 0 24 24" fill="#229ED9"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/></svg>
</a>

<script>
// â”€â”€ CONTRATOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const contractAddr = "0x07Fc7AC9D681Cdd3D100c68f6f5646970CC7fF60";
const usdtAddr     = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";
const piskAddr     = "0x9d5B2A73d16dAF61712BA8527d94F6997a0E6323";
const TOKENS_PER_USDT = 10;

const minABI = [
  {constant:false,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],type:"function"},
  {constant:true,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"},
  {constant:true,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],type:"function"}
];
const buyABI = [{inputs:[{name:"_amountUSDT",type:"uint256"}],name:"buyWithUSDT",outputs:[],stateMutability:"nonpayable",type:"function"}];

let web3Instance = null;
let cuentaConectada = null;

// â”€â”€ UI HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(msg, tipo) {
  document.getElementById('status').textContent = msg;
  const dot = document.getElementById('statusDot');
  dot.className = 'status-dot';
  if (tipo === 'ok')     dot.classList.add('green');
  else if (tipo === 'err')  dot.classList.add('red');
  else if (tipo === 'wait') dot.classList.add('orange');
}

function calcularPisk() {
  const usdt = parseFloat(document.getElementById('inputUSDT').value) || 0;
  const pisk = usdt * TOKENS_PER_USDT;
  document.getElementById('piskCalc').textContent = pisk > 0 ? pisk.toLocaleString() + ' $PISK' : 'â€” $PISK';
}

// â”€â”€ DETECTAR ENTORNO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esMobil() { return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent); }
function estaDentroDeMetaMask() {
  return typeof window.ethereum !== 'undefined' &&
    (window.ethereum.isMetaMask || window.ethereum.providers?.some(p => p.isMetaMask));
}
function mostrarModalMetaMask() { document.getElementById('metamaskModal').style.display = 'flex'; }
function cerrarModalMetaMask()  { document.getElementById('metamaskModal').style.display = 'none'; }

function abrirEnMetaMask() {
  const url = window.location.href.replace(/^https?:\/\//, '');
  window.location.href = `https://metamask.app.link/dapp/${url}`;
  setTimeout(cerrarModalMetaMask, 1000);
}

function copiarURL() {
  navigator.clipboard.writeText(window.location.href).then(() => {
    setStatus('âœ… URL copiada â€” pega en navegador MetaMask', 'ok');
    setTimeout(() => setStatus('Polygon Network Â· Listo', ''), 3000);
  }).catch(() => prompt("Copia esta URL:", window.location.href));
}

function copyContract() {
  navigator.clipboard.writeText(piskAddr).then(() => {
    setStatus('âœ… Contrato $PISK copiado', 'ok');
    setTimeout(() => setStatus('Polygon Network Â· Listo', ''), 3000);
  });
}

// â”€â”€ DETECTAR PROVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function detectarProvider() {
  await new Promise(r => setTimeout(r, 300));
  if (typeof window.ethereum !== 'undefined') {
    let provider = window.ethereum;
    if (window.ethereum.providers?.length) {
      const mm = window.ethereum.providers.find(p => p.isMetaMask);
      if (mm) provider = mm;
    }
    web3Instance = new Web3(provider);
    return true;
  }
  return false;
}

// â”€â”€ CONECTAR WALLET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function conectarWallet() {
  setStatus('Conectando...', 'wait');
  if (esMobil() && !estaDentroDeMetaMask()) {
    mostrarModalMetaMask();
    setStatus('Abre en navegador MetaMask', 'wait');
    return;
  }
  const ok = await detectarProvider();
  if (!ok) {
    setStatus('MetaMask no detectado', 'err');
    alert("âŒ Instala MetaMask desde metamask.io");
    return;
  }
  try {
    const accounts = await Promise.race([
      window.ethereum.request({ method: 'eth_requestAccounts' }),
      new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 60000))
    ]);
    if (!accounts?.length) throw new Error("Sin cuentas");
    cuentaConectada = accounts[0];

    const chainId = await web3Instance.eth.getChainId();
    if (chainId !== 137) {
      setStatus('Cambiando a Polygon...', 'wait');
      try {
        await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x89' }] });
      } catch (e) {
        if (e.code === 4902) {
          await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [{
            chainId:'0x89', chainName:'Polygon Mainnet',
            nativeCurrency:{name:'MATIC',symbol:'MATIC',decimals:18},
            rpcUrls:['https://polygon-rpc.com/'],
            blockExplorerUrls:['https://polygonscan.com/']
          }]});
        } else throw e;
      }
    }

    await actualizarSaldo();
    const short = cuentaConectada.slice(0,6)+'...'+cuentaConectada.slice(-4);
    setStatus('âœ… Conectado: ' + short, 'ok');
    document.getElementById('walletAddr').textContent = cuentaConectada;

  } catch(e) {
    if (e.code === 4001) setStatus('ConexiÃ³n rechazada', 'err');
    else if (e.message === 'Timeout') setStatus('Esperando aprobaciÃ³n...', 'wait');
    else setStatus('Error: ' + e.message, 'err');
  }
}

async function actualizarSaldo() {
  if (!cuentaConectada) return;
  try {
    const pisk = new web3Instance.eth.Contract(minABI, piskAddr);
    const bal  = await pisk.methods.balanceOf(cuentaConectada).call();
    const num  = parseFloat(web3Instance.utils.fromWei(bal, 'ether')).toFixed(2);
    document.getElementById('saldoDisplay').textContent = parseFloat(num).toLocaleString() + ' $PISK';
  } catch(e) {}
}

async function getSafeGasPrice() {
  const gp = await web3Instance.eth.getGasPrice();
  return Math.floor(parseInt(gp) * 1.2).toString();
}

// â”€â”€ APPROVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function approveUSDT() {
  const val = document.getElementById('inputUSDT').value;
  if (!val || val <= 0) { alert("âš ï¸ Ingresa un monto vÃ¡lido"); return; }
  if (!cuentaConectada) { await conectarWallet(); return; }
  try {
    const usdt      = new web3Instance.eth.Contract(minABI, usdtAddr);
    const monto     = (parseFloat(val) * 1000000).toFixed(0);
    const gasPrice  = await getSafeGasPrice();
    setStatus('Verificando permisos...', 'wait');
    const allowance = await usdt.methods.allowance(cuentaConectada, contractAddr).call();
    if (parseInt(allowance) > 0) {
      setStatus('Reseteando permiso...', 'wait');
      await usdt.methods.approve(contractAddr, "0").send({ from: cuentaConectada, gasPrice });
      await new Promise(r => setTimeout(r, 2000));
    }
    setStatus('Aprueba ' + val + ' USDT en MetaMask...', 'wait');
    await usdt.methods.approve(contractAddr, monto).send({ from: cuentaConectada, gasPrice });
    setStatus('âœ… USDT autorizado â€” ejecuta paso 2', 'ok');
  } catch(e) {
    if (e.code === 4001) setStatus('AutorizaciÃ³n rechazada', 'err');
    else setStatus('Error: verifica saldo USDT', 'err');
  }
}

// â”€â”€ COMPRAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function buyPisk() {
  const val = document.getElementById('inputUSDT').value;
  if (!val || val <= 0) { alert("âš ï¸ Primero autoriza el monto"); return; }
  if (!cuentaConectada) { await conectarWallet(); return; }
  try {
    const neo      = new web3Instance.eth.Contract(buyABI, contractAddr);
    const monto    = (parseFloat(val) * 1000000).toFixed(0);
    const gasPrice = await getSafeGasPrice();
    setStatus('Confirma la compra en MetaMask...', 'wait');
    const tx = await neo.methods.buyWithUSDT(monto).send({ from: cuentaConectada, gas: 300000, gasPrice });
    setStatus('ğŸ‰ Â¡Compra exitosa!', 'ok');
    document.getElementById('inputUSDT').value = '';
    document.getElementById('piskCalc').textContent = 'â€” $PISK';
    setTimeout(actualizarSaldo, 3000);
  } catch(e) {
    if (e.code === 4001) setStatus('Compra cancelada', 'err');
    else setStatus('Error: verifica autorizaciÃ³n y saldo', 'err');
  }
}

// â”€â”€ EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (typeof window.ethereum !== 'undefined') {
  window.ethereum.on('accountsChanged', accounts => {
    if (!accounts.length) {
      cuentaConectada = null;
      document.getElementById('saldoDisplay').textContent = '0.00 $PISK';
      document.getElementById('walletAddr').textContent = 'â€”';
      setStatus('Desconectado', 'err');
    } else {
      cuentaConectada = accounts[0];
      actualizarSaldo();
    }
  });
  window.ethereum.on('chainChanged', () => window.location.reload());
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', async () => {
  await detectarProvider();
  if (web3Instance) {
    try {
      const accounts = await web3Instance.eth.getAccounts();
      if (accounts?.length) {
        cuentaConectada = accounts[0];
        await actualizarSaldo();
        document.getElementById('walletAddr').textContent = cuentaConectada;
        setStatus('âœ… Ya conectado', 'ok');
      }
    } catch(e) {}
  }
});
</script>
</body>
</html>
